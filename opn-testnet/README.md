# OPN Testnet 工具集

OPN 测试网自动化工具集合，包含水龙头领取和链上 Claim 操作。

## 工具列表

### 1. opn-faucet.py - 水龙头自动领取

自动破解验证码并领取测试币。

**功能特性**：

- 🔐 自动从私钥生成 EVM 钱包地址
- 🤖 自动破解 reCAPTCHA 验证码
- 🌐 支持代理 IP（可选配置）
- 🧵 多线程并发处理（可配置线程数，大幅提升效率）
- 💧 批量领取多个钱包地址
- 🔄 智能重试机制（失败自动重试最多 3 次）
- ⏭️ 智能跳过已领取地址（检测到已领取则直接处理下一个）
- 📝 详细的日志输出和进度显示
- 💾 自动保存领取结果

### 2. opn-claim.py - 链上 Claim 操作

在 OPN 测试网上执行合约 claim 操作。

**功能特性**：

- ⛓️ 连接 OPN 测试网 RPC
- 🔐 批量处理多个钱包
- 🧵 多线程并发处理（可配置线程数，提升效率）
- 💰 自动检查余额
- 📤 执行合约交易
- 🔄 智能重试机制（最多 3 次）
- 🔍 自动生成区块浏览器链接
- 💾 保存交易结果

**网络信息**：

- RPC: https://testnet-rpc.iopn.tech
- Chain ID: 984
- 区块浏览器: https://testnet.iopn.tech
- Claim 合约: 0xbc5c49abc5282994bd2c641438391d5e2e730c25

## 环境要求

- Python 3.7+
- 有效的 nocaptcha.io 账户和 TOKEN（仅 opn-faucet.py 需要）
- OPN 测试网代币（仅 opn-claim.py 需要，用于 gas 费）

## 安装步骤

1. 安装依赖：

```bash
pip install -r requirements.txt
```

2. 配置环境变量：

```bash
cp .env.example .env
```

3. 编辑 `.env` 文件，填入您的配置：

```bash
# 从 https://www.nocaptcha.io/register?c=P4QdvE 获取的 USER_TOKEN
USER_TOKEN=your_nocaptcha_token

# 代理IP API地址（可选，如不配置则不使用代理）
PROXY_API=http://api.ipipgo.com/ip?cty=TW&c=1&pt=1&ft=txt&pat=\n&rep=1&key=your_key_here

# 并发线程数（可选，默认为5）
# 建议根据机器性能和代理IP数量调整：1-10 为合理范围
MAX_WORKERS=5
```

4. 配置钱包私钥：

```bash
cp wallet.json.example wallet.json
```

编辑 `wallet.json`，添加您的钱包私钥（支持带或不带 0x 前缀）：

```json
["your_private_key_1", "0xyour_private_key_2", "your_private_key_3"]
```

⚠️ **重要**：`wallet.json` 存放的是**私钥**，不是地址！脚本会自动将私钥转换为 EVM 地址。

## 使用方法

### 方法 1：水龙头领取（opn-faucet.py）

用于从水龙头领取测试币：

```bash
python opn-faucet.py
```

脚本会自动：

- 🔐 读取 `wallet.json` 中的所有私钥并转换为地址
- 🧵 使用多线程并发处理（默认 5 个线程）
- 🌐 每次请求前获取新的代理 IP（如已配置）
- 🔄 为每个地址获取验证码并领取水龙头
- 🔁 失败自动重试（最多 3 次，每次间隔 2 秒）
- 📊 显示实时进度和统计信息
- 💾 保存详细结果到 `claim_results.json`（包含私钥和地址对应关系）

执行示例输出：

```
🔐 开始转换私钥为地址...
  [1] 0x1234************************************5678
  [2] 0xabcd************************************abcd
  [3] 0x9876************************************3210
  [4] 0xdef0************************************1234
  [5] 0x5678************************************abcd

📋 成功转换 5 个钱包地址
🧵 线程数: 5
============================================================

🚀 开始批量处理钱包...

[1/5] 🚀 开始处理: 0x1234************************************5678
[2/5] 🚀 开始处理: 0xabcd************************************abcd
[3/5] 🚀 开始处理: 0x9876************************************3210
[4/5] 🚀 开始处理: 0xdef0************************************1234
[5/5] 🚀 开始处理: 0x5678************************************abcd

[1/5] 🔄 获取代理IP...
[2/5] 🔄 获取代理IP...
[1/5] ✅ 代理IP设置成功
[3/5] 🔄 获取代理IP...
[2/5] ✅ 代理IP设置成功
[1/5] 🔄 获取验证码...
[4/5] 🔄 获取代理IP...
[2/5] 🔄 获取验证码...
[3/5] ✅ 代理IP设置成功
[1/5] ✅ 验证码获取成功
[5/5] 🔄 获取代理IP...
[1/5] 🔄 发送领取请求...
[2/5] ✅ 验证码获取成功
[3/5] 🔄 获取验证码...
[2/5] 🔄 发送领取请求...
[1/5] 📊 响应状态码: 200
[1/5] ✅ 领取成功! 0x1234************************************5678
[4/5] ✅ 代理IP设置成功
[2/5] 📊 响应状态码: 200
[2/5] ✅ 领取成功! 0xabcd************************************abcd
[3/5] ✅ 验证码获取成功
[3/5] 🔄 发送领取请求...
[5/5] ✅ 代理IP设置成功
[4/5] 🔄 获取验证码...
[3/5] 📊 响应状态码: 400
[3/5] ❌ 领取失败! 状态码: 400
[3/5] ⏭️  该地址最近已经领取过，跳过重试

✅ 进度: 1/5 已完成

✅ 进度: 2/5 已完成

✅ 进度: 3/5 已完成
[4/5] ✅ 验证码获取成功
[5/5] 🔄 获取验证码...
[4/5] 🔄 发送领取请求...
[4/5] 📊 响应状态码: 200
[4/5] ✅ 领取成功! 0xdef0************************************1234
[5/5] ✅ 验证码获取成功
[5/5] 🔄 发送领取请求...
[5/5] 📊 响应状态码: 200
[5/5] ✅ 领取成功! 0x5678************************************abcd

✅ 进度: 4/5 已完成

✅ 进度: 5/5 已完成

============================================================
📊 执行完成！统计信息：
============================================================
✅ 成功: 4 个
⏭️  已领取过: 1 个
❌ 失败: 0 个
📝 总计: 5 个
⏱️  总耗时: 28.45 秒
🧵 使用线程数: 5
⚡ 平均速度: 5.69 秒/个

💾 详细结果已保存到: claim_results.json
```

### 方法 2：链上 Claim 操作（opn-claim.py）

用于在 OPN 测试网上执行合约 claim 操作：

```bash
python opn-claim.py
```

脚本会自动：

- 🔗 连接到 OPN 测试网
- 🔐 读取 `wallet.json` 中的所有私钥
- 🧵 使用多线程并发处理（默认 3 个线程）
- 💰 检查每个钱包的余额
- 📤 执行合约 claim 交易
- 🔁 失败自动重试（最多 3 次，每次间隔 3 秒）
- 🔍 生成区块浏览器链接
- 💾 保存详细结果到 `claim_results.json`

执行示例输出：

```
🔗 连接到 OPN 测试网...
✅ 已连接到 OPN 测试网
📊 当前区块高度: 12345

🔐 开始加载钱包...
  [1] 0x1234************************************5678 (余额: 1.234567 OPN)
  [2] 0xabcd************************************abcd (余额: 0.567890 OPN)
  [3] 0x9876************************************3210 (余额: 0.812345 OPN)

📋 成功加载 3 个钱包
🧵 线程数: 3
======================================================================

🚀 开始批量处理账户...

[1/3] 🚀 开始处理: 0x1234************************************5678
[1/3] 💰 余额: 1.234567 OPN
[2/3] 🚀 开始处理: 0xabcd************************************abcd
[2/3] 💰 余额: 0.567890 OPN
[3/3] 🚀 开始处理: 0x9876************************************3210
[3/3] 💰 余额: 0.812345 OPN

[1/3] 🔄 执行 claim 操作...
[2/3] 🔄 执行 claim 操作...
[3/3] 🔄 执行 claim 操作...

[1/3] 📤 交易已发送: 0xabc123...
[1/3] 🔍 查看交易: https://testnet.iopn.tech/tx/0xabc123...
[1/3] ⏳ 等待交易确认...
[2/3] 📤 交易已发送: 0xdef456...
[2/3] 🔍 查看交易: https://testnet.iopn.tech/tx/0xdef456...
[2/3] ⏳ 等待交易确认...
[3/3] 📤 交易已发送: 0x789abc...
[3/3] 🔍 查看交易: https://testnet.iopn.tech/tx/0x789abc...
[3/3] ⏳ 等待交易确认...

[1/3] ✅ Claim 成功! 0x1234************************************5678
[1/3] 📝 交易哈希: 0xabc123...

✅ 进度: 1/3 已完成

[2/3] ✅ Claim 成功! 0xabcd************************************abcd
[2/3] 📝 交易哈希: 0xdef456...

✅ 进度: 2/3 已完成

[3/3] ✅ Claim 成功! 0x9876************************************3210
[3/3] 📝 交易哈希: 0x789abc...

✅ 进度: 3/3 已完成

======================================================================
📊 执行完成！统计信息：
======================================================================
✅ 成功: 3 个
❌ 失败: 0 个
📝 总计: 3 个
⏱️  总耗时: 45.23 秒
🧵 使用线程数: 3
⚡ 平均速度: 15.08 秒/个

💾 详细结果已保存到: claim_results.json
🔍 区块浏览器: https://testnet.iopn.tech
```

⚠️ **注意**：执行 claim 操作需要钱包有足够的 OPN 代币作为 gas 费。建议先使用 opn-faucet.py 领取测试币。

### 完整工作流程

推荐的完整操作流程：

```bash
# 1. 生成钱包（如果还没有）
cd ../utils
python generate_wallets.py
# 输入数量，生成 wallet.json

# 2. 复制到 opn-testnet 目录
cp wallet.json ../opn-testnet/

# 3. 领取测试币
cd ../opn-testnet
python opn-faucet.py
# 等待完成，钱包将获得测试币

# 4. 执行 claim 操作
python opn-claim.py
# 使用测试币执行链上 claim
```

## 配置说明

### USER_TOKEN

从 [nocaptcha.io](https://www.nocaptcha.io/register?c=P4QdvE) 获取的用户 TOKEN，用于破解 reCAPTCHA。

**使用范围**：仅 opn-faucet.py 需要

### PROXY_API（可选）

代理 IP 获取 API 地址，用于每次领水时使用不同的 IP 地址。

**配置示例**：

```bash
PROXY_API=http://api.ipipgo.com/ip?cty=TW&c=1&pt=1&ft=txt&pat=\n&rep=1&key=your_key_here
```

**功能说明**：

- 🌐 每次领水前自动获取新的代理 IP
- 🔄 如果代理获取失败，会自动使用直连方式
- 📝 支持返回格式：`IP:端口`（如：`38.55.17.118:54055`）
- ⚠️ 如果不配置此项，脚本将不使用代理

**使用范围**：仅 opn-faucet.py 需要

### MAX_WORKERS（可选）

并发线程数，用于控制同时处理多少个钱包。

**配置示例**：

```bash
MAX_WORKERS=5
```

**性能建议**：

**opn-faucet.py（默认 5 线程）**：

- 💻 单核/双核 CPU：建议 2-3 个线程
- 🖥️ 四核 CPU：建议 3-5 个线程
- 🚀 八核+ CPU：建议 5-10 个线程
- 🌐 根据代理 IP 数量调整：线程数不要超过可用代理数
- ⚠️ 线程过多可能导致 IP 限流或验证码额度消耗过快

**opn-claim.py（默认 3 线程）**：

- 💻 单核/双核 CPU：建议 2 个线程
- 🖥️ 四核 CPU：建议 2-3 个线程
- 🚀 八核+ CPU：建议 3-5 个线程
- ⛓️ 链上交易较慢，不建议线程过多
- ⚠️ 过多线程可能导致 nonce 冲突

**使用范围**：两个脚本都支持

### wallet.json

包含需要领取水龙头的钱包**私钥**列表，JSON 数组格式：

```json
["私钥1", "0x私钥2", "私钥3"]
```

⚠️ **注意**：

- 存放的是**私钥**，不是地址
- 私钥可以带或不带 `0x` 前缀
- 脚本会自动将私钥转换为 EVM 地址
- **务必保护好此文件，不要泄露或提交到 Git**

### claim_results.json

脚本执行后自动生成的结果文件，包含详细的执行记录。

**opn-faucet.py 结果格式**：

```json
{
  "timestamp": "2025-10-31 12:34:56",
  "total": 3,
  "success": 2,
  "already_claimed": 1,
  "failed": 0,
  "details": [
    {
      "address": "0x...",
      "private_key": "0x...",
      "status": "success",
      "attempts": 1,
      "response": {...}
    },
    {
      "address": "0x...",
      "private_key": "0x...",
      "status": "already_claimed",
      "attempts": 1,
      "response": "This address has already claimed recently"
    }
  ]
}
```

**opn-claim.py 结果格式**：

```json
{
  "timestamp": "2025-10-31 12:34:56",
  "network": "OPN Testnet",
  "chain_id": 984,
  "contract": "0xbc5c49abc5********************730c25",
  "total": 2,
  "success": 2,
  "failed": 0,
  "details": [
    {
      "address": "0x...",
      "private_key": "0x...",
      "status": "success",
      "attempts": 1,
      "tx_hash": "0xabc123...",
      "explorer_url": "https://testnet.iopn.tech/tx/0xabc123..."
    }
  ]
}
```

- `status` 字段可能的值：
  - `success`: 领取成功
  - `already_claimed`: 该地址最近已经领取过
  - `failed`: 领取失败
  - `error`: 请求异常
- `attempts` 字段表示成功所需的尝试次数（1-3）
- `tx_hash` 字段包含交易哈希（仅 opn-claim.py）
- `explorer_url` 字段包含区块浏览器链接（仅 opn-claim.py）
- ⚠️ **注意**：此文件包含私钥信息，已添加到 `.gitignore`，请妥善保管。

## 注意事项

⚠️ **重要提示**：

- 此工具仅用于测试网环境
- 请勿滥用水龙头服务
- 确保您的 nocaptcha.io 账户有足够的额度（仅 opn-faucet.py）
- **🔒 `wallet.json` 存储的是私钥，务必保护好，不要泄露或提交到 Git**
- **🔒 `claim_results.json` 包含私钥信息，也要妥善保管**
- 保护好您的 `.env` 文件
- 两个脚本都使用多线程并发处理，大幅提升效率
  - opn-faucet.py：默认 5 线程，适合领水场景
  - opn-claim.py：默认 3 线程，适合链上交易场景
- 失败会自动重试最多 3 次
- 如果检测到地址已经领取过，会自动跳过重试并处理下一个地址（opn-faucet.py）
- 线程数建议根据机器性能调整：
  - faucet: 2-10 个线程，需考虑代理 IP 数量和验证码额度
  - claim: 2-5 个线程，避免 nonce 冲突
- ⚠️ 线程数过高可能导致验证码额度消耗过快或触发限流（faucet）
- ⚠️ claim 线程过多可能导致 nonce 冲突或 RPC 限流
- 私钥支持带或不带 `0x` 前缀，脚本会自动处理
- opn-claim.py 需要钱包有足够的 OPN 代币作为 gas 费

## OPN 测试网信息

根据 [OPN 测试网浏览器](https://testnet.iopn.tech)：

- **RPC URL**: https://testnet-rpc.iopn.tech
- **Chain ID**: 984
- **区块浏览器**: https://testnet.iopn.tech
- **Claim 合约地址**: 0xbc5c49abc5282994bd2c641438391d5e2e730c25
- **Claim 函数**: 0x4e71d92d

## 常见问题

### 私钥转换失败

- 检查私钥格式是否正确（64 位十六进制字符）
- 确保私钥是有效的 EVM 私钥

### 验证码获取失败

- 检查 USER_TOKEN 是否正确
- 检查 nocaptcha.io 账户是否有足够额度

### 领取失败

- 检查生成的钱包地址是否正确
- 检查是否已经达到领取上限
- 检查网络连接是否正常

### 多线程性能问题

**问题**：多线程没有明显提速或者反而变慢？

**解决方案**：

- 🔍 检查代理 IP 是否足够：线程数不应超过可用代理 IP 数量
- 💰 检查验证码额度是否充足：多线程会同时消耗多个验证码
- 🌐 检查网络带宽：多线程同时请求需要足够的网络带宽
- 🔧 适当降低线程数：从 2-3 开始尝试，逐步增加到最优值
- 📊 观察日志输出：看是否有大量超时或失败

**性能对比参考（10 个钱包）**：

**opn-faucet.py（领水）**：

- 单线程模式：约 150-180 秒（每个 15-18 秒，含等待时间）
- 5 线程模式：约 30-40 秒（并发处理，大幅提速 4-5 倍）
- 10 线程模式：约 20-30 秒（需要足够的代理和额度，提速 6-8 倍）

**opn-claim.py（链上交易）**：

- 单线程模式：约 80-100 秒（每个 8-10 秒，含等待时间）
- 3 线程模式：约 30-35 秒（并发处理，提速 2.5-3 倍）
- 5 线程模式：约 20-25 秒（提速 4-5 倍，但可能有 nonce 冲突风险）

### 如何调整线程数

编辑 `.env` 文件：

**opn-faucet.py 建议配置**：

```bash
# 保守模式（适合网络较慢或代理较少）
MAX_WORKERS=2

# 平衡模式（推荐，适合大多数情况）
MAX_WORKERS=5

# 激进模式（需要足够的代理IP和验证码额度）
MAX_WORKERS=10
```

**opn-claim.py 建议配置**：

```bash
# 保守模式（避免 nonce 冲突）
MAX_WORKERS=2

# 平衡模式（推荐，适合大多数情况）
MAX_WORKERS=3

# 激进模式（需要稳定的 RPC 和良好的网络）
MAX_WORKERS=5
```

⚠️ **注意**：claim 脚本线程数不要设置太高（建议不超过 5），否则可能导致 nonce 冲突或 RPC 限流。

## License

MIT
